ç‚¹å‡»è¿”å›[ğŸ”—æˆ‘çš„åšå®¢æ–‡ç« ç›®å½•](https://percheung.github.io/#/toc)
* ç›®å½•
{:toc}
<div onclick="window.scrollTo({top:0,behavior:'smooth'});" style="background-color:white;position:fixed;bottom:20px;right:40px;padding:10px 10px 5px 10px;cursor:pointer;z-index:10;border-radius:13%;box-shadow:0.5px 3px 7px rgba(0,0,0,0.3);"><img src="https://percheung.github.io/blogImg/backTop.png" alt="TOP" style="background-color:white;width:30px;"></div>

# ffmpegä½¿ç”¨æ‰‹å†Œ

> æœ¬æ•™ç¨‹æŒç»­æ›´æ–°ï¼Œæˆ‘å­¦åˆ°å¤šå°‘å°±æ›´æ–°å¤šå°‘

<div style="text-align: center;">
  <img src="https://percheung.github.io/blogImg/FFmpeg.png" width="30%" alt="ffmpeg" />
</div>

## ffmpegæ˜¯ä»€ä¹ˆ

FFmpegæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è‡ªç”±è½¯ä»¶ï¼Œå¯ä»¥æ‰§è¡ŒéŸ³é¢‘å’Œè§†é¢‘å¤šç§æ ¼å¼çš„å½•å½±ã€è½¬æ¢ã€ä¸²æµåŠŸèƒ½ï¼ŒåŒ…å«äº†libavcodecâ€”â€”è¿™æ˜¯ä¸€ä¸ªç”¨äºå¤šä¸ªé¡¹ç›®ä¸­éŸ³é¢‘å’Œè§†é¢‘çš„è§£ç å™¨å‡½å¼åº“ï¼Œä»¥åŠlibavformatâ€”â€”ä¸€ä¸ªéŸ³é¢‘ä¸è§†é¢‘æ ¼å¼è½¬æ¢å‡½å¼åº“ã€‚

å…·ä½“è¯·çœ‹[https://zh.wikipedia.org/wiki/FFmpeg](https://zh.wikipedia.org/wiki/FFmpeg)

## æŒ‡ä»¤æ€»ç»“

### 1.æŸ¥çœ‹ffmpegç‰ˆæœ¬

```bash
ffmpeg -version
```

### 2.mkvè½¬mp4

```bash
ffmpeg -i input.mkv -vcodec copy -acodec copy out.mp4
```

### 3.è£å‰ª .mkv è§†é¢‘

```bash
ffmpeg -i input.mkv -ss [start] -t [duration] -c copy output.mkv
```

- `input.mkv` æ˜¯ä½ è¦è£å‰ªçš„åŸå§‹è§†é¢‘æ–‡ä»¶ã€‚
- `[start]` æ˜¯ä½ è¦å¼€å§‹è£å‰ªçš„æ—¶é—´ï¼Œæ ¼å¼ä¸º `HH:MM:SS`ã€‚
- `[duration]` æ˜¯ä½ è¦è£å‰ªçš„æŒç»­æ—¶é—´ï¼Œæ ¼å¼ä¹Ÿæ˜¯ `HH:MM:SS`ã€‚
- `output.mkv` æ˜¯è£å‰ªåçš„æ–°è§†é¢‘æ–‡ä»¶ã€‚

### 4.ä¸è°ƒèŠ‚å¸§ç‡ï¼Œå°½å¯èƒ½ä¿è¯åŸè§†é¢‘è´¨é‡çš„æƒ…å†µä¸‹å°†åŸå§‹è§†é¢‘å‹ç¼©

è¦ä½¿ç”¨FFmpegå°†è§†é¢‘æ–‡ä»¶çš„å¤§å°å‡å°ï¼Œå¯ä»¥è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š

```bash
ffmpeg -i input.mp4 -crf 23 -preset medium output.mp4
```

è¿™ä¸ªå‘½ä»¤å°†ä¼šå°†è¾“å…¥è§†é¢‘æ–‡ä»¶`input.mp4`çš„å ç”¨ä½“ç§¯å‡å°ï¼Œå¹¶ç”Ÿæˆè¾“å‡ºè§†é¢‘æ–‡ä»¶`output.mp4`ã€‚

#### 4.1 crf

åœ¨FFmpegä¸­ï¼Œ`-crf`å‚æ•°æ˜¯ç”¨äºæ§åˆ¶è§†é¢‘ç¼–ç çš„è´¨é‡ä¸å‹ç¼©æ¯”ä¹‹é—´çš„æƒè¡¡çš„å‚æ•°ã€‚CRFï¼ˆConstant Rate Factorï¼‰æ˜¯ä¸€ç§åŸºäºç›®æ ‡è´¨é‡çš„æ’å®šæ¯”ç‰¹ç‡æ§åˆ¶æ–¹æ³•ï¼Œå®ƒå…è®¸ä½ è®¾ç½®è¾“å‡ºè§†é¢‘çš„è´¨é‡æ°´å¹³ã€‚CRFå€¼è¶Šå°ï¼Œè§†é¢‘çš„è´¨é‡è¶Šé«˜ï¼Œä½†æ–‡ä»¶å¤§å°ä¹Ÿä¼šå¢åŠ ã€‚

åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒCRFå€¼çš„èŒƒå›´æ˜¯0åˆ°51ã€‚ä¸åŒçš„èŒƒå›´å€¼å¯¹åº”ä¸åŒçš„è´¨é‡å’Œå‹ç¼©çº§åˆ«ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„CRFå€¼å’Œå¯¹åº”çš„ç‰¹å¾ï¼š

- 0ï¼šæ— æŸæ¨¡å¼ï¼Œäº§ç”Ÿéå¸¸å¤§çš„æ–‡ä»¶ï¼Œè´¨é‡æœ€å¥½ã€‚
- 18-28ï¼šä¸€èˆ¬æ¨èèŒƒå›´ï¼Œè¾ƒé«˜çš„è´¨é‡å’Œæ–‡ä»¶å¤§å°å¹³è¡¡ã€‚
- 23ï¼šé»˜è®¤å€¼ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µï¼Œæä¾›è‰¯å¥½çš„è´¨é‡å’Œåˆç†çš„æ–‡ä»¶å¤§å°ã€‚
- 29-51ï¼šè¾ƒä½è´¨é‡çš„èŒƒå›´ï¼Œé€‚ç”¨äºä½æ¯”ç‰¹ç‡å‹ç¼©æˆ–è¦æ±‚è¾ƒå°æ–‡ä»¶å¤§å°çš„æƒ…å†µã€‚

ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œåå¥½é€‰æ‹©åˆé€‚çš„CRFå€¼ã€‚è¾ƒä½çš„CRFå€¼ä¼šæä¾›æ›´å¥½çš„è´¨é‡ï¼Œä½†ä¼šå¢åŠ æ–‡ä»¶å¤§å°ã€‚è¾ƒé«˜çš„CRFå€¼ä¼šå‡å°æ–‡ä»¶å¤§å°ï¼Œä½†å¯èƒ½å¯¼è‡´ä¸€äº›è´¨é‡æŸå¤±ã€‚

è¯·æ³¨æ„ï¼Œä¸åŒçš„è§†é¢‘ç¼–è§£ç å™¨å¯èƒ½å¯¹CRFå€¼çš„èŒƒå›´æœ‰æ‰€ä¸åŒï¼Œå…·ä½“å–å€¼èŒƒå›´å’Œæ•ˆæœå¯èƒ½ä¼šæœ‰æ‰€å·®å¼‚ã€‚å»ºè®®åœ¨å®é™…åº”ç”¨ä¸­è¿›è¡Œæµ‹è¯•å’Œè°ƒæ•´ï¼Œä»¥æ‰¾åˆ°æœ€é€‚åˆä½ éœ€æ±‚çš„CRFå€¼ã€‚

#### 4.2 preset

åœ¨FFmpegä¸­ï¼Œ`-preset`å‚æ•°ç”¨äºè®¾ç½®è§†é¢‘ç¼–ç å™¨çš„é¢„è®¾ï¼ˆpresetï¼‰ã€‚é¢„è®¾æ˜¯ä¸€ç»„é¢„å®šä¹‰çš„ç¼–ç å‚æ•°ï¼Œå¯ä»¥å½±å“ç¼–ç é€Ÿåº¦å’Œè¾“å‡ºè´¨é‡ä¹‹é—´çš„æƒè¡¡ã€‚ä¸åŒçš„é¢„è®¾æä¾›äº†ä¸åŒçš„é€Ÿåº¦å’Œè´¨é‡é€‰é¡¹ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é¢„è®¾é€‰é¡¹ï¼š

- `ultrafast`ï¼šæœ€å¿«çš„ç¼–ç é€Ÿåº¦ï¼Œä½†è´¨é‡è¾ƒä½ã€‚
- `superfast`ï¼šéå¸¸å¿«çš„ç¼–ç é€Ÿåº¦ï¼Œç¨å¾®é™ä½äº†ä¸€äº›è´¨é‡ã€‚
- `veryfast`ï¼šéå¸¸å¿«çš„ç¼–ç é€Ÿåº¦ï¼Œè´¨é‡ç¨ä½ã€‚
- `faster`ï¼šå¿«é€Ÿçš„ç¼–ç é€Ÿåº¦ï¼Œè´¨é‡ç•¥æœ‰é™ä½ã€‚
- `fast`ï¼šç›¸å¯¹è¾ƒå¿«çš„ç¼–ç é€Ÿåº¦ï¼Œè´¨é‡è¾ƒå¥½ã€‚
- `medium`ï¼šå¹³è¡¡äº†é€Ÿåº¦å’Œè´¨é‡ï¼Œæ˜¯é»˜è®¤é¢„è®¾ã€‚
- `slow`ï¼šè¾ƒæ…¢çš„ç¼–ç é€Ÿåº¦ï¼Œè´¨é‡æ›´å¥½ã€‚
- `slower`ï¼šæ›´æ…¢çš„ç¼–ç é€Ÿåº¦ï¼Œè´¨é‡æ›´é«˜ã€‚
- `veryslow`ï¼šéå¸¸æ…¢çš„ç¼–ç é€Ÿåº¦ï¼Œæä¾›æœ€å¥½çš„è´¨é‡ã€‚

è¿™äº›é¢„è®¾é€‰é¡¹æä¾›äº†ä¸åŒçš„é€Ÿåº¦å’Œè´¨é‡å¹³è¡¡ã€‚å¦‚æœä½ å¸Œæœ›ç¼–ç é€Ÿåº¦æ›´å¿«ï¼Œå¯ä»¥é€‰æ‹©é€Ÿåº¦è¾ƒå¿«çš„é¢„è®¾ï¼Œä½†å¯èƒ½ä¼šç‰ºç‰²ä¸€äº›è´¨é‡ã€‚å¦‚æœä½ æ›´æ³¨é‡è¾“å‡ºè´¨é‡ï¼Œå¯ä»¥é€‰æ‹©é€Ÿåº¦è¾ƒæ…¢çš„é¢„è®¾ï¼Œä½†ç¼–ç é€Ÿåº¦ä¼šå˜æ…¢ã€‚

ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©é€‚åˆçš„é¢„è®¾é€‰é¡¹ã€‚è¦æŒ‡å®šé¢„è®¾ï¼Œè¯·ä½¿ç”¨`-preset`å‚æ•°åè·Ÿé¢„è®¾åç§°ï¼Œä¾‹å¦‚`-preset medium`ã€‚

è¯·æ³¨æ„ï¼Œä¸åŒçš„è§†é¢‘ç¼–è§£ç å™¨å¯èƒ½æ”¯æŒä¸åŒçš„é¢„è®¾é€‰é¡¹ï¼Œå…·ä½“çš„é¢„è®¾é€‰é¡¹å’Œæ•ˆæœå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚å»ºè®®åœ¨å®é™…åº”ç”¨ä¸­è¿›è¡Œæµ‹è¯•å’Œè°ƒæ•´ï¼Œä»¥æ‰¾åˆ°æœ€é€‚åˆä½ éœ€æ±‚çš„é¢„è®¾é€‰é¡¹ã€‚

### 5.è°ƒèŠ‚è§†é¢‘å¸§ç‡

```bash
ffmpeg -i input.mp4 -r 24 output.mp4
```

`-i` é€‰é¡¹æŒ‡å®šäº†è¾“å…¥æ–‡ä»¶çš„åç§°ä¸º `input.mp4`ï¼Œ`-r` é€‰é¡¹æŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶çš„å¸§é€Ÿç‡ä¸º 24 å¸§æ¯ç§’ï¼ˆfpsï¼‰ï¼Œå¹¶ä¸” `output.mp4` æ˜¯è¾“å‡ºæ–‡ä»¶çš„åç§°ã€‚

### 6.è°ƒèŠ‚å¸§ç‡ï¼Œå°½å¯èƒ½ä¿è¯åŸè§†é¢‘è´¨é‡çš„æƒ…å†µä¸‹å°†åŸå§‹è§†é¢‘å‹ç¼©

> å°†5å’Œ6çš„æ€»ç»“èµ·æ¥

```bash
ffmpeg -i input.mp4 -r 24 -crf 23 -preset slower output.mp4
```

æ•ˆæœæ˜¯å°†æˆ‘åŸå…ˆ10å…†å¤§å°çš„è§†é¢‘æ–‡ä»¶ï¼Œå‹ç¼©åˆ°äº†5å…†ã€‚
